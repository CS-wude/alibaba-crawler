# æ··æ·†çŸ©é˜µè¯¦è§£ - èƒ¸éƒ¨Xå…‰ç‰‡åˆ†ç±»é¡¹ç›®

## ğŸ“‹ ç›®å½•
- [åŸºç¡€æ¦‚å¿µ](#åŸºç¡€æ¦‚å¿µ)
- [çŸ©é˜µç»“æ„](#çŸ©é˜µç»“æ„)
- [å…³é”®æŒ‡æ ‡](#å…³é”®æŒ‡æ ‡)
- [åŒ»å­¦åº”ç”¨](#åŒ»å­¦åº”ç”¨)
- [å¯è§†åŒ–è§£è¯»](#å¯è§†åŒ–è§£è¯»)
- [å®é™…æ¡ˆä¾‹](#å®é™…æ¡ˆä¾‹)
- [æ¨¡å‹ä¼˜åŒ–](#æ¨¡å‹ä¼˜åŒ–)
- [ä»£ç å®ç°](#ä»£ç å®ç°)

---

## åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æ··æ·†çŸ©é˜µï¼Ÿ

æ··æ·†çŸ©é˜µï¼ˆConfusion Matrixï¼‰æ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°åˆ†ç±»æ¨¡å‹æ€§èƒ½çš„è¡¨æ ¼å·¥å…·ã€‚å®ƒé€šè¿‡å¯¹æ¯”æ¨¡å‹çš„é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾ï¼Œç›´è§‚åœ°æ˜¾ç¤ºæ¨¡å‹åœ¨å„ä¸ªç±»åˆ«ä¸Šçš„è¡¨ç°ã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ“Š å±•ç¤ºåˆ†ç±»ç»“æœçš„è¯¦ç»†åˆ†å¸ƒ
- ğŸ” è¯†åˆ«æ¨¡å‹çš„é”™è¯¯æ¨¡å¼
- ğŸ“ˆ è®¡ç®—å„ç§è¯„ä¼°æŒ‡æ ‡
- ğŸ¯ æŒ‡å¯¼æ¨¡å‹æ”¹è¿›æ–¹å‘

### ä¸ºä»€ä¹ˆå«"æ··æ·†"çŸ©é˜µï¼Ÿ

å› ä¸ºå®ƒæ˜¾ç¤ºäº†æ¨¡å‹å¯¹ä¸åŒç±»åˆ«çš„"æ··æ·†"ç¨‹åº¦ï¼š
- å¦‚æœæ¨¡å‹å®Œç¾ï¼ŒçŸ©é˜µåªåœ¨å¯¹è§’çº¿ä¸Šæœ‰å€¼
- å¦‚æœæ¨¡å‹å¾ˆ"æ··æ·†"ï¼Œéå¯¹è§’çº¿ä½ç½®ä¼šæœ‰å¾ˆå¤šå€¼
- æ··æ·†è¶Šä¸¥é‡ï¼Œåˆ†ç±»æ•ˆæœè¶Šå·®

---

## çŸ©é˜µç»“æ„

### 2Ã—2 æ··æ·†çŸ©é˜µï¼ˆäºŒåˆ†ç±»ï¼‰

åœ¨æˆ‘ä»¬çš„èƒ¸éƒ¨Xå…‰ç‰‡åˆ†ç±»é¡¹ç›®ä¸­ï¼Œæ··æ·†çŸ©é˜µçš„ç»“æ„å¦‚ä¸‹ï¼š

```
                    é¢„æµ‹ç»“æœ
                NORMAL    PNEUMONIA
çœŸå®æ ‡ç­¾ NORMAL    TN        FP
        PNEUMONIA  FN        TP
```

### å››ä¸ªæ ¸å¿ƒæ¦‚å¿µ

| ç¬¦å· | è‹±æ–‡å…¨ç§° | ä¸­æ–‡åç§° | å«ä¹‰ | åŒ»å­¦è§£é‡Š |
|------|----------|----------|------|----------|
| **TN** | True Negative | çœŸè´Ÿä¾‹ | å®é™…æ­£å¸¸ï¼Œé¢„æµ‹æ­£å¸¸ âœ… | æ­£ç¡®è¯†åˆ«å¥åº·äºº |
| **FP** | False Positive | å‡æ­£ä¾‹ | å®é™…æ­£å¸¸ï¼Œé¢„æµ‹è‚ºç‚ âŒ | è¯¯è¯Šï¼ˆå‡è­¦æŠ¥ï¼‰ |
| **FN** | False Negative | å‡è´Ÿä¾‹ | å®é™…è‚ºç‚ï¼Œé¢„æµ‹æ­£å¸¸ ğŸš¨ | æ¼è¯Šï¼ˆæœ€å±é™©ï¼ï¼‰ |
| **TP** | True Positive | çœŸæ­£ä¾‹ | å®é™…è‚ºç‚ï¼Œé¢„æµ‹è‚ºç‚ âœ… | æ­£ç¡®è¯†åˆ«æ‚£è€… |

### è®°å¿†æŠ€å·§

```
True/False  â†’ é¢„æµ‹æ˜¯å¦æ­£ç¡®
Positive/Negative â†’ é¢„æµ‹çš„ç±»åˆ«ï¼ˆè‚ºç‚/æ­£å¸¸ï¼‰

TN: True + Negative  â†’ æ­£ç¡®é¢„æµ‹ä¸ºæ­£å¸¸
FP: False + Positive â†’ é”™è¯¯é¢„æµ‹ä¸ºè‚ºç‚
FN: False + Negative â†’ é”™è¯¯é¢„æµ‹ä¸ºæ­£å¸¸  
TP: True + Positive  â†’ æ­£ç¡®é¢„æµ‹ä¸ºè‚ºç‚
```

---

## å…³é”®æŒ‡æ ‡

### 1. å‡†ç¡®ç‡ (Accuracy)

```
å‡†ç¡®ç‡ = (TP + TN) / (TP + TN + FP + FN)
```

**å«ä¹‰**ï¼šæ‰€æœ‰é¢„æµ‹ä¸­æ­£ç¡®çš„æ¯”ä¾‹  
**ç‰¹ç‚¹**ï¼š
- âœ… ç›´è§‚æ˜“æ‡‚
- âŒ åœ¨ç±»åˆ«ä¸å¹³è¡¡æ—¶å¯èƒ½è¯¯å¯¼
- ğŸ¯ é€‚åˆå¹³è¡¡æ•°æ®é›†

**ç¤ºä¾‹**ï¼š
```
å¦‚æœ1000ä¸ªæ ·æœ¬ä¸­ï¼Œ900ä¸ªé¢„æµ‹æ­£ç¡®
å‡†ç¡®ç‡ = 900/1000 = 90%
```

### 2. ç²¾ç¡®ç‡ (Precision)

```
ç²¾ç¡®ç‡ = TP / (TP + FP)
```

**å«ä¹‰**ï¼šåœ¨æ‰€æœ‰é¢„æµ‹ä¸ºè‚ºç‚çš„ç—…ä¾‹ä¸­ï¼ŒçœŸæ­£æ˜¯è‚ºç‚çš„æ¯”ä¾‹  
**åŒ»å­¦è§£é‡Š**ï¼šæ¨¡å‹è¯´æ˜¯è‚ºç‚æ—¶ï¼Œæœ‰å¤šå¤§æŠŠæ¡æ˜¯çœŸçš„ï¼Ÿ

**ç¤ºä¾‹**ï¼š
```
æ¨¡å‹é¢„æµ‹100ä¸ªè‚ºç‚ç—…ä¾‹ï¼Œå…¶ä¸­85ä¸ªçœŸçš„æ˜¯è‚ºç‚
ç²¾ç¡®ç‡ = 85/100 = 85%
```

### 3. å¬å›ç‡ (Recall/Sensitivity)

```
å¬å›ç‡ = TP / (TP + FN)
```

**å«ä¹‰**ï¼šåœ¨æ‰€æœ‰çœŸå®è‚ºç‚ç—…ä¾‹ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«çš„æ¯”ä¾‹  
**åŒ»å­¦è§£é‡Š**ï¼šæ‰€æœ‰è‚ºç‚æ‚£è€…ä¸­ï¼Œæœ‰å¤šå°‘è¢«å‘ç°äº†ï¼Ÿ

**é‡è¦æ€§**ï¼šâ­â­â­â­â­ åœ¨åŒ»å­¦è¯Šæ–­ä¸­æœ€é‡è¦ï¼

**ç¤ºä¾‹**ï¼š
```
100ä¸ªè‚ºç‚æ‚£è€…ä¸­ï¼Œæ¨¡å‹æ‰¾åˆ°äº†95ä¸ª
å¬å›ç‡ = 95/100 = 95%
```

### 4. ç‰¹å¼‚æ€§ (Specificity)

```
ç‰¹å¼‚æ€§ = TN / (TN + FP)
```

**å«ä¹‰**ï¼šåœ¨æ‰€æœ‰çœŸå®æ­£å¸¸ç—…ä¾‹ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«çš„æ¯”ä¾‹  
**åŒ»å­¦è§£é‡Š**ï¼šæ‰€æœ‰å¥åº·äººä¸­ï¼Œæœ‰å¤šå°‘è¢«æ­£ç¡®è¯†åˆ«ä¸ºå¥åº·ï¼Ÿ

### 5. F1åˆ†æ•°

```
F1åˆ†æ•° = 2 Ã— (ç²¾ç¡®ç‡ Ã— å¬å›ç‡) / (ç²¾ç¡®ç‡ + å¬å›ç‡)
```

**å«ä¹‰**ï¼šç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°  
**ç‰¹ç‚¹**ï¼šå¹³è¡¡è€ƒè™‘ç²¾ç¡®ç‡å’Œå¬å›ç‡

### æŒ‡æ ‡é‡è¦æ€§æ’åºï¼ˆåŒ»å­¦åœºæ™¯ï¼‰

1. **å¬å›ç‡** ğŸ¥‡ - ä¸èƒ½æ¼è¯Š
2. **F1åˆ†æ•°** ğŸ¥ˆ - ç»¼åˆè¡¨ç°
3. **ç²¾ç¡®ç‡** ğŸ¥‰ - å‡å°‘è¯¯è¯Š
4. **ç‰¹å¼‚æ€§** - ä¿æŠ¤å¥åº·äºº
5. **å‡†ç¡®ç‡** - æ•´ä½“è¡¨ç°

---

## åŒ»å­¦åº”ç”¨

### åŒ»å­¦è¯Šæ–­çš„ç‰¹æ®Šæ€§

åœ¨åŒ»å­¦è¯Šæ–­ä¸­ï¼Œ**å‡é˜´æ€§ï¼ˆæ¼è¯Šï¼‰æ¯”å‡é˜³æ€§ï¼ˆè¯¯è¯Šï¼‰æ›´å±é™©**ï¼š

| é”™è¯¯ç±»å‹ | åæœ | ä¸¥é‡ç¨‹åº¦ |
|----------|------|----------|
| **å‡é˜³æ€§ (FP)** | å¥åº·äººè¢«è¯¯è¯Š â†’ ä¸å¿…è¦çš„æ£€æŸ¥å’Œç„¦è™‘ | âš ï¸ ä¸­ç­‰ |
| **å‡é˜´æ€§ (FN)** | æ‚£è€…è¢«æ¼è¯Š â†’ å»¶è¯¯æ²»ç–—ï¼Œå¯èƒ½è‡´å‘½ | ğŸš¨ ä¸¥é‡ |

### åŒ»å­¦AIçš„è¯„ä¼°æ ‡å‡†

```
âœ… ä¼˜ç§€æ¨¡å‹ï¼šå¬å›ç‡ > 95%ï¼Œç²¾ç¡®ç‡ > 80%
âš ï¸  å¯æ¥å—ï¼šå¬å›ç‡ > 90%ï¼Œç²¾ç¡®ç‡ > 70%
âŒ ä¸åˆæ ¼ï¼šå¬å›ç‡ < 90%
```

### å®é™…åº”ç”¨ç­–ç•¥

1. **ç­›æŸ¥é˜¶æ®µ**ï¼šå®å¯è¯¯è¯Šï¼Œä¸èƒ½æ¼è¯Š
   - é™ä½åˆ†ç±»é˜ˆå€¼
   - æé«˜å¬å›ç‡è‡³95%+
   
2. **ç¡®è¯Šé˜¶æ®µ**ï¼šç»“åˆåŒ»ç”Ÿåˆ¤æ–­
   - äººå·¥å¤æŸ¥å¯ç–‘ç—…ä¾‹
   - AIä½œä¸ºè¾…åŠ©å·¥å…·

---

## å¯è§†åŒ–è§£è¯»

### çƒ­åŠ›å›¾è§£è¯»

```
ç†æƒ³çš„æ··æ·†çŸ©é˜µï¼ˆçƒ­åŠ›å›¾ï¼‰ï¼š

[æ·±è‰²]  [æµ…è‰²]    â† å¯¹è§’çº¿æ·±è‰² = é¢„æµ‹æ­£ç¡®å¤š
[æµ…è‰²]  [æ·±è‰²]    â† éå¯¹è§’çº¿æµ…è‰² = é¢„æµ‹é”™è¯¯å°‘
```

### é¢œè‰²å«ä¹‰

- **æ·±è“è‰²**ï¼šæ•°å€¼å¤§ï¼Œåœ¨å¯¹è§’çº¿ä¸Šæ˜¯å¥½äº‹ï¼ˆé¢„æµ‹æ­£ç¡®ï¼‰
- **æµ…è“è‰²**ï¼šæ•°å€¼å°ï¼Œåœ¨éå¯¹è§’çº¿ä¸Šæ˜¯å¥½äº‹ï¼ˆé¢„æµ‹é”™è¯¯å°‘ï¼‰
- **å·¦ä¸‹è§’**ï¼šæœ€éœ€è¦å…³æ³¨çš„åŒºåŸŸï¼ˆæ¼è¯Šï¼‰

### ä¸€çœ¼åˆ¤æ–­æ¨¡å‹å¥½å

1. **çœ‹å¯¹è§’çº¿**ï¼šé¢œè‰²è¶Šæ·±è¶Šå¥½
2. **çœ‹å·¦ä¸‹è§’**ï¼šé¢œè‰²è¶Šæµ…è¶Šå¥½ï¼ˆæ¼è¯Šå°‘ï¼‰
3. **çœ‹æ•°å€¼åˆ†å¸ƒ**ï¼šæ˜¯å¦é›†ä¸­åœ¨å¯¹è§’çº¿

---

## å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šä¼˜ç§€æ¨¡å‹

```
                é¢„æµ‹ç»“æœ
              NORMAL  PNEUMONIA
çœŸå®æ ‡ç­¾ NORMAL  [228]    [6]     
        PNEUMONIA [8]    [382]   
```

**åˆ†æ**ï¼š
- TN=228, FP=6, FN=8, TP=382
- å‡†ç¡®ç‡ = (228+382)/(228+6+8+382) = 97.8%
- å¬å›ç‡ = 382/(382+8) = 97.9%
- ç²¾ç¡®ç‡ = 382/(382+6) = 98.5%

**è¯„ä»·**ï¼šâ­â­â­â­â­ ä¼˜ç§€ï¼æ¼è¯Šç‡ä»…2.1%

### æ¡ˆä¾‹2ï¼šæœ‰é—®é¢˜çš„æ¨¡å‹

```
                é¢„æµ‹ç»“æœ
              NORMAL  PNEUMONIA
çœŸå®æ ‡ç­¾ NORMAL  [200]    [34]     
        PNEUMONIA [45]    [345]   
```

**åˆ†æ**ï¼š
- TN=200, FP=34, FN=45, TP=345
- å‡†ç¡®ç‡ = (200+345)/(200+34+45+345) = 87.3%
- å¬å›ç‡ = 345/(345+45) = 88.5%
- ç²¾ç¡®ç‡ = 345/(345+34) = 91.0%

**è¯„ä»·**ï¼šâŒ ä¸åˆæ ¼ï¼æ¼è¯Šç‡11.5%å¤ªé«˜

### æ¡ˆä¾‹3ï¼šè¿‡äºä¿å®ˆçš„æ¨¡å‹

```
                é¢„æµ‹ç»“æœ
              NORMAL  PNEUMONIA
çœŸå®æ ‡ç­¾ NORMAL  [180]    [54]     
        PNEUMONIA [2]     [388]   
```

**åˆ†æ**ï¼š
- TN=180, FP=54, FN=2, TP=388
- å‡†ç¡®ç‡ = (180+388)/(180+54+2+388) = 91.0%
- å¬å›ç‡ = 388/(388+2) = 99.5%
- ç²¾ç¡®ç‡ = 388/(388+54) = 87.8%

**è¯„ä»·**ï¼šâœ… å¯æ¥å—ï¼å¬å›ç‡å¾ˆé«˜ï¼Œè¯¯è¯Šç¨å¤šä½†å¯æ¥å—

---

## æ¨¡å‹ä¼˜åŒ–

### åŸºäºæ··æ·†çŸ©é˜µçš„æ”¹è¿›ç­–ç•¥

#### 1. å‡é˜´æ€§(FN)è¿‡å¤š - æ¼è¯Šä¸¥é‡

**é—®é¢˜è¡¨ç°**ï¼š
```
å¬å›ç‡ < 90%
å·¦ä¸‹è§’æ•°å€¼è¾ƒå¤§
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. é™ä½åˆ†ç±»é˜ˆå€¼
threshold = 0.3  # ä»é»˜è®¤0.5é™ä½åˆ°0.3

# 2. è°ƒæ•´ç±»åˆ«æƒé‡
class_weights = {0: 1.0, 1: 2.0}  # å¢åŠ è‚ºç‚ç±»åˆ«æƒé‡

# 3. ä½¿ç”¨Focal Loss
criterion = FocalLoss(alpha=1, gamma=2)

# 4. æ•°æ®å¢å¼º - å¢åŠ è‚ºç‚æ ·æœ¬
```

#### 2. å‡é˜³æ€§(FP)è¿‡å¤š - è¯¯è¯Šé¢‘ç¹

**é—®é¢˜è¡¨ç°**ï¼š
```
ç²¾ç¡®ç‡ < 70%
å³ä¸Šè§’æ•°å€¼è¾ƒå¤§
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. å¢åŠ æ¨¡å‹å¤æ‚åº¦
model_name = 'resnet101'  # ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹

# 2. å¢åŠ è®­ç»ƒæ•°æ®
# 3. è°ƒæ•´æ•°æ®å¢å¼ºç­–ç•¥
# 4. ä½¿ç”¨é›†æˆå­¦ä¹ 
```

#### 3. æ•´ä½“æ€§èƒ½ä¸ä½³

**é—®é¢˜è¡¨ç°**ï¼š
```
å‡†ç¡®ç‡ < 85%
F1åˆ†æ•° < 80%
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. æ£€æŸ¥æ•°æ®è´¨é‡
# 2. å¢åŠ è®­ç»ƒè½®æ•°
num_epochs = 50

# 3. è°ƒæ•´å­¦ä¹ ç‡
learning_rate = 0.0001

# 4. ä½¿ç”¨é¢„è®­ç»ƒæƒé‡
pretrained = True
```

### é˜ˆå€¼ä¼˜åŒ–

```python
# å¯»æ‰¾æœ€ä½³é˜ˆå€¼çš„ä»£ç ç¤ºä¾‹
import numpy as np
from sklearn.metrics import precision_recall_curve

def find_best_threshold(y_true, y_scores, min_recall=0.95):
    """
    æ‰¾åˆ°æ»¡è¶³æœ€å°å¬å›ç‡è¦æ±‚çš„æœ€ä½³é˜ˆå€¼
    """
    precision, recall, thresholds = precision_recall_curve(y_true, y_scores)
    
    # æ‰¾åˆ°å¬å›ç‡ >= min_recall çš„é˜ˆå€¼
    valid_indices = np.where(recall >= min_recall)[0]
    
    if len(valid_indices) > 0:
        # åœ¨æ»¡è¶³å¬å›ç‡è¦æ±‚çš„å‰æä¸‹ï¼Œé€‰æ‹©ç²¾ç¡®ç‡æœ€é«˜çš„é˜ˆå€¼
        best_idx = valid_indices[np.argmax(precision[valid_indices])]
        best_threshold = thresholds[best_idx]
        return best_threshold, precision[best_idx], recall[best_idx]
    else:
        return None, None, None

# ä½¿ç”¨ç¤ºä¾‹
best_threshold, best_precision, best_recall = find_best_threshold(
    y_true, y_scores, min_recall=0.95
)
print(f"æœ€ä½³é˜ˆå€¼: {best_threshold:.3f}")
print(f"ç²¾ç¡®ç‡: {best_precision:.3f}")
print(f"å¬å›ç‡: {best_recall:.3f}")
```

---

## ä»£ç å®ç°

### 1. ç”Ÿæˆæ··æ·†çŸ©é˜µ

```python
from sklearn.metrics import confusion_matrix, classification_report
import seaborn as sns
import matplotlib.pyplot as plt

def plot_confusion_matrix(y_true, y_pred, class_names):
    """ç»˜åˆ¶æ··æ·†çŸ©é˜µ"""
    
    # ç”Ÿæˆæ··æ·†çŸ©é˜µ
    cm = confusion_matrix(y_true, y_pred)
    
    # åˆ›å»ºå›¾å½¢
    plt.figure(figsize=(10, 8))
    
    # ç»˜åˆ¶çƒ­åŠ›å›¾
    sns.heatmap(cm, annot=True, fmt='d', cmap='Blues',
                xticklabels=class_names, yticklabels=class_names)
    
    plt.title('æ··æ·†çŸ©é˜µ')
    plt.xlabel('é¢„æµ‹æ ‡ç­¾')
    plt.ylabel('çœŸå®æ ‡ç­¾')
    plt.show()
    
    return cm
```

### 2. è®¡ç®—è¯„ä¼°æŒ‡æ ‡

```python
def calculate_metrics(cm):
    """ä»æ··æ·†çŸ©é˜µè®¡ç®—å„ç§æŒ‡æ ‡"""
    
    TN, FP, FN, TP = cm.ravel()
    
    # åŸºæœ¬æŒ‡æ ‡
    accuracy = (TP + TN) / (TP + TN + FP + FN)
    precision = TP / (TP + FP) if (TP + FP) > 0 else 0
    recall = TP / (TP + FN) if (TP + FN) > 0 else 0
    specificity = TN / (TN + FP) if (TN + FP) > 0 else 0
    
    # F1åˆ†æ•°
    f1_score = 2 * (precision * recall) / (precision + recall) if (precision + recall) > 0 else 0
    
    # é”™è¯¯ç‡
    false_positive_rate = FP / (FP + TN) if (FP + TN) > 0 else 0
    false_negative_rate = FN / (FN + TP) if (FN + TP) > 0 else 0
    
    return {
        'accuracy': accuracy,
        'precision': precision,
        'recall': recall,
        'specificity': specificity,
        'f1_score': f1_score,
        'false_positive_rate': false_positive_rate,
        'false_negative_rate': false_negative_rate
    }
```

### 3. æ¨¡å‹è¯„ä¼°å®Œæ•´æµç¨‹

```python
def evaluate_model_comprehensive(model, test_loader, device):
    """å®Œæ•´çš„æ¨¡å‹è¯„ä¼°"""
    
    model.eval()
    all_preds = []
    all_labels = []
    all_probs = []
    
    with torch.no_grad():
        for inputs, labels in test_loader:
            inputs, labels = inputs.to(device), labels.to(device)
            
            outputs = model(inputs)
            probs = torch.softmax(outputs, dim=1)
            _, preds = torch.max(outputs, 1)
            
            all_preds.extend(preds.cpu().numpy())
            all_labels.extend(labels.cpu().numpy())
            all_probs.extend(probs.cpu().numpy())
    
    # ç”Ÿæˆæ··æ·†çŸ©é˜µ
    cm = confusion_matrix(all_labels, all_preds)
    
    # è®¡ç®—æŒ‡æ ‡
    metrics = calculate_metrics(cm)
    
    # å¯è§†åŒ–
    class_names = ['NORMAL', 'PNEUMONIA']
    plot_confusion_matrix(all_labels, all_preds, class_names)
    
    # æ‰“å°æŠ¥å‘Š
    print("åˆ†ç±»æŠ¥å‘Š:")
    print(classification_report(all_labels, all_preds, target_names=class_names))
    
    print(f"\nè¯¦ç»†æŒ‡æ ‡:")
    for metric, value in metrics.items():
        print(f"{metric}: {value:.4f}")
    
    return cm, metrics, all_probs
```

### 4. å®é™…ä½¿ç”¨ç¤ºä¾‹

```python
# åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨
if __name__ == "__main__":
    # åŠ è½½æ¨¡å‹
    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    model = create_model(num_classes=2, model_name='resnet50').to(device)
    
    # åŠ è½½æ£€æŸ¥ç‚¹
    checkpoint = torch.load('checkpoints/best_model.pth', map_location=device)
    model.load_state_dict(checkpoint['model_state_dict'])
    
    # åˆ›å»ºæ•°æ®åŠ è½½å™¨
    _, test_loader = create_data_loaders('../../data/ChestXRay', batch_size=32)
    
    # è¯„ä¼°æ¨¡å‹
    cm, metrics, probs = evaluate_model_comprehensive(model, test_loader, device)
    
    # åˆ†æç»“æœ
    if metrics['recall'] < 0.95:
        print("ğŸš¨ è­¦å‘Šï¼šå¬å›ç‡åä½ï¼Œå¯èƒ½å­˜åœ¨æ¼è¯Šé£é™©ï¼")
        print("å»ºè®®ï¼šé™ä½åˆ†ç±»é˜ˆå€¼æˆ–è°ƒæ•´æ¨¡å‹å‚æ•°")
    else:
        print("âœ… å¬å›ç‡è¡¨ç°è‰¯å¥½")
```

---

## æ€»ç»“

### å…³é”®è¦ç‚¹

1. **æ··æ·†çŸ©é˜µæ˜¯åˆ†ç±»è¯„ä¼°çš„æ ¸å¿ƒå·¥å…·**
2. **åœ¨åŒ»å­¦åº”ç”¨ä¸­ï¼Œå¬å›ç‡æ¯”ç²¾ç¡®ç‡æ›´é‡è¦**
3. **è¦ç»“åˆå¤šä¸ªæŒ‡æ ‡ç»¼åˆè¯„ä¼°æ¨¡å‹**
4. **å¯è§†åŒ–æœ‰åŠ©äºå¿«é€Ÿè¯†åˆ«é—®é¢˜**
5. **åŸºäºæ··æ·†çŸ©é˜µå¯ä»¥æŒ‡å¯¼æ¨¡å‹ä¼˜åŒ–**

### å®ç”¨æ£€æŸ¥æ¸…å•

è¯„ä¼°ä½ çš„èƒ¸éƒ¨Xå…‰ç‰‡åˆ†ç±»æ¨¡å‹æ—¶ï¼Œæ£€æŸ¥è¿™äº›è¦ç‚¹ï¼š

- [ ] å¬å›ç‡ > 95%ï¼ˆæœ€é‡è¦ï¼‰
- [ ] ç²¾ç¡®ç‡ > 80%
- [ ] æ··æ·†çŸ©é˜µå¯¹è§’çº¿é¢œè‰²æ·±
- [ ] å·¦ä¸‹è§’ï¼ˆæ¼è¯Šï¼‰æ•°å€¼å°
- [ ] F1åˆ†æ•° > 85%
- [ ] æ— æ˜æ˜¾çš„ç±»åˆ«åå‘

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¿è¡Œè¯„ä¼°**ï¼š`python main.py eval --checkpoint checkpoints/best_model.pth`
2. **æŸ¥çœ‹æ··æ·†çŸ©é˜µ**ï¼šé‡ç‚¹å…³æ³¨å¬å›ç‡å’Œæ¼è¯Šæƒ…å†µ
3. **ä¼˜åŒ–æ¨¡å‹**ï¼šå¦‚æœå¬å›ç‡ä¸è¶³ï¼Œè°ƒæ•´é˜ˆå€¼æˆ–é‡æ–°è®­ç»ƒ
4. **éªŒè¯æ”¹è¿›**ï¼šåœ¨æ–°æ•°æ®ä¸Šæµ‹è¯•ä¼˜åŒ–åçš„æ¨¡å‹

---

## å‚è€ƒèµ„æ–™

- [Scikit-learnæ··æ·†çŸ©é˜µæ–‡æ¡£](https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html)
- [åŒ»å­¦AIè¯„ä¼°æ ‡å‡†](https://www.nature.com/articles/s41591-020-0842-3)
- [æ·±åº¦å­¦ä¹ åœ¨åŒ»å­¦å½±åƒä¸­çš„åº”ç”¨](https://arxiv.org/abs/1711.05225)

---

*æœ€åæ›´æ–°ï¼š2024å¹´1æœˆ*  
*é¡¹ç›®ï¼šèƒ¸éƒ¨Xå…‰ç‰‡åˆ†ç±»ç³»ç»Ÿ*  
*ä½œè€…ï¼šPyTorchå­¦ä¹ é¡¹ç›®* 